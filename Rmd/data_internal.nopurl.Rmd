---
editor_options:
  chunk_output_type: console
---

NOTES:

-   This file is *not* included in the [source package](https://r-pkgs.org/package-structure-state.html#source-package) because of the [`.nopurl` suffix in its
    filename](https://rpkg.dev/pkgpurl/reference/purl_rmd.html#-rmd-files-excluded-from-purling).

-   The chunks below have to be manually executed in order to regenerate the package data.

# Define data

NOTES:

-   Although the datasets below are saved as ["internal data" in `R/sysdata.rda`](https://r-pkgs.org/data.html#data-sysdata), some of them might still be
    exported and documented (in the main `.Rmd` document), something [not explicitly
    mentioned](https://coolbutuseless.github.io/2018/12/10/r-packages-internal-and-external-data/) in the book [R
    Packages](https://r-pkgs.org/data.html#data-data).

## `defaults`

TODO:

-   Create `question_blocks.toml` with sensible sample data (a block "demographics" etc.).

```{r}
defaults                 <- list()
defaults$items           <- pal::toml_read(input = "data-raw/default_config/items.toml")
# defaults$question_blocks <- pal::toml_read(input = "data-raw/default_config/question_blocks.toml")
defaults$value_sets      <- pal::toml_read(input = "data-raw/default_config/value_sets.toml")
defaults$targets         <- pal::toml_read(input = "data-raw/default_config/targets.toml")
defaults$footnotes       <- pal::toml_read(input = "data-raw/default_config/footnotes.toml")
defaults$links           <- pal::toml_read(input = "data-raw/default_config/links.toml")
```

## `item_keys`

Supported qstnr specification part keys.

TODO:

-   Extract as much of info as possible from the JSON Schemas!

```{r}
item_keys <-
  readr::read_csv(file = "data-raw/item_keys.csv",
                  na = "",
                  col_types = "cccllccc") %>%
  dplyr::mutate(components = stringr::str_split(string = components,
                                                pattern = ","),
                default_val = purrr::map2(.x = default,
                                          .y = type,
                                          .f = ~ {
                                            if (is.na(.x)) {
                                              eval(parse(text = glue::glue("{.y}()")))
                                            } else {
                                              eval(parse(text = .x))
                                            }
                                          }),
                has_default = purrr::map_lgl(default_val,
                                             length)) %>%
  dplyr::select(-default)
```

# Write data

Save all the small data objects as a single internal file `R/sysdata.rda`. Note that when documenting them, they must be explicitly `@export`ed to be available
to package users.

```{r}
usethis::use_data(defaults,
                  item_keys,
                  internal = TRUE,
                  overwrite = TRUE,
                  compress = "xz",
                  version = 3L)
```
